import { useState, useEffect } from 'react';
import { getFilterList } from '@/util/qlikConnection';
import './ComboBox.css';

export default function ComboBox({ app, filterItem, onChange }) {
  const [selectedValue, setSelectedValue] = useState('');
  const [options, setOptions] = useState([]);

  useEffect(() => {
    if (filterItem) {
      getFilterList(app, filterItem).then((items) => {
        console.log(items)
        setOptions(items);
      });
    }
  }, [app, filterItem]);

  useEffect(() => {
    const selectedOption = options.find((option) => option.qState === 'S');
    if (selectedOption) {
      setSelectedValue(selectedOption.text);
    }
  }, [options]);

  const handleChange = (event) => {
    const newValue = event.target.value;
    setSelectedValue(newValue);
    onChange(newValue);
  };

  const truncateText = (text, maxLength = 30) => {
    return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
  };

  return (
    options != null ? (
      <div className="combobox-container ml-2">
        <select
          value={selectedValue}
          onChange={handleChange}
          className="combobox"
        >
          {options.map((option, index) => (
            <option
              key={index}
              value={option.text}
              className="combobox-option"
              title={option.text} // Full text as a tooltip
            >
              {truncateText(option.text)}
            </option>
          ))}
        </select>
      </div>
    ) : (
      <></>
    )
  );
}



  const handleClickCombobox = (selectedValue) => {
    console.log(selectedValue)
    app.field("EKIP").selectValues([selectedValue]);
    // setTimeout(() => {
    //   setRandomKey(Math.random());
    // }, 250);
  };

  return (
    <>
      <div className="d-flex mt-3">
        <Link className="d-flex text-decoration-none" to="/pipeline-health">
          <PageMainButton icon={<BackIcon />} title="Geri" />
        </Link>
      </div>
      <div className="combobox-wrapper">
        <ComboBox app={app} filterItem={"PERIOD_100_DETAIL"} onChange={handleClickCombobox} />
      </div>

