import { useState, useEffect } from 'react';
import { getFilterList } from '@/util/qlikConnection';
import './ComboBox.css';

export default function ComboBox({ app, filterItem, onChange, headerTitle }) {
  const [selectedValue, setSelectedValue] = useState('');
  const [options, setOptions] = useState([]);

  useEffect(() => {
    if (filterItem) {
      getFilterList(app, filterItem).then((items) => {
        setOptions(items);
      });
    }
  }, [app, filterItem]);

  useEffect(() => {
    const selectedOption = options.find((option) => option.qState === 'S');
    if (selectedOption) {
      setSelectedValue(selectedOption.text);
    }
  }, [options]);

  const handleChange = (event) => {
    const newValue = event.target.value;
    setSelectedValue(newValue);
    onChange(newValue,filterItem);
  };

  const truncateText = (text, maxLength = 30) => {
    return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
  };

  return (
    options != null ? (
      <div className="combobox-container ml-2">
        <select
          value={selectedValue}
          onChange={handleChange}
          className="combobox"
        >
          <option value="" disabled>{headerTitle}</option> {/* "Seçiniz" seçeneğini ekledik */}
          {options.map((option, index) => (
            <option
              key={index}
              value={option.text}
              className="combobox-option"
              title={option.text} // Full text as a tooltip
            >
              {truncateText(option.text)}
            </option>
          ))}
        </select>
      </div>
    ) : (
      <></>
    )
  );
}

